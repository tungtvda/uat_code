<?php// Require required controllersCore::requireController('staff');Core::requireController('permission');class Voucher extends BaseController{	protected $controller_name = "voucher";	protected function Start()	{		// Determines Prefix for Loading Section Model Method		if ($this->section!='main') {			$this->prefix = $this->section;		}		$model = new VoucherModel();		return $model;	}    public function Access($access)    {        require_once('modules/voucher/voucher.model.php');        // Load Model        $start = Voucher::Start();        $loadModel = $this->prefix.__FUNCTION__;        $param = $start->$loadModel();        // 0 for public page, 1 for private page        if ($access==0)        {            if ($_SESSION['agent']['ID']!="")            {                Helper::redirect($param['config']['SITE_DIR']."/agent/agent/dashboard");            }        }        else if ($access==1)        {            if ($_SESSION['agent']['ID']=="")            {                // Store destination URL                $_SESSION['agent']['redirect_url'] = $_SERVER["REQUEST_URI"];                // Sends user to login page if autologin cookie is verified? - Not implemented                Helper::redirect($param['config']['SITE_DIR']."/agent/agent/login");            }            else            {                // Force password change if Prompt is enabled                $constant = get_defined_constants(true);                // Redirect if user is in Member section but not in Password page                if (($_SESSION['agent']['Prompt']==1)&&($constant['user']['LOAD_ACTION']!="password")&&($constant['user']['LOAD_ACTION']!="passwordprocess")&&($constant['user']['LOAD_ACTION']!="logout"))                {                    Helper::redirect($param['config']['SITE_DIR']."/agent/agent/password");                }            }        }    }    protected function Index(){        if ($this->section=='agent')        {            // Control Access            Voucher::Access(1);        }        // Load Model        $start = $this->Start();        $loadModel = $this->prefix.__FUNCTION__;        $param = $start->$loadModel($this->id);        $this->ReturnView($param, true);    }    protected function Add(){        if ($this->section=='agent')        {            // Control Access            Voucher::Access(1);        }        // Load Model        $start = $this->Start();        $loadModel = $this->prefix.__FUNCTION__;        $param = $start->$loadModel($this->id);        $this->ReturnView($param, true);    }    protected function addvoucherprocess(){        if ($this->section=='agent')        {            // Control Access            $this->Access(1);            CRUD::validateFormSubmit('Add');        }        // Load Model        $start = $this->Start();        $loadModel = $this->prefix.__FUNCTION__;        $param = $start->$loadModel();        if ($this->section=='agent')        {            $_SESSION['agent']['agent_add'] = $param['status'];            if ($param['status']['ok']=="1")            {                Helper::redirect($param['config']['SITE_DIR']."/agent/voucher/index");            }            else            {                Helper::redirect($param['config']['SITE_DIR']."/agent/voucher/add");            }        }    }    protected function View(){        if ($this->section=='agent')        {            // Control Access            $this->Access(1);        }        // Load Model        $start = $this->Start();         $loadModel = $this->prefix.__FUNCTION__;        $param = $start->$loadModel($this->id);        $this->ReturnView($param, true);    }    protected function Delete(){        if ($this->section=='agent')        {            // Control Access            $this->Access(1);        }        // Load Model        $start = $this->Start();        $loadModel = $this->prefix.__FUNCTION__;        $param = $start->$loadModel($this->id);        if(isset($_GET['page']))        {            $page=$_GET['page'];        }        else{            $page='all';        }        Helper::redirect($param['config']['SITE_DIR']."/agent/voucher/index?page=".$page);    }    protected function Downline(){        if ($this->section=='agent')        {            // Control Access            Voucher::Access(1);        }        // Load Model        $start = $this->Start();        $loadModel = $this->prefix.__FUNCTION__;        $param = $start->$loadModel($this->id);        $this->ReturnView($param, true);    }    function Status(){        if ($this->section=='agent')        {            // Control Access            Voucher::Access(1);        }        // Load Model        $start = $this->Start();        $loadModel = $this->prefix.__FUNCTION__;//        $arr=array(//            'id'=>$_GET['id'],//            'value'=>$_GET['value'],//        );       echo $param = $start->$loadModel();    }    protected function AccountSummary(){        if ($this->section=='agent')        {            // Control Access            Voucher::Access(1);        }        // Load Model        $start = $this->Start();         $loadModel = $this->prefix.__FUNCTION__;        $param = $start->$loadModel($this->id);        $this->ReturnView($param, true);    }}?>